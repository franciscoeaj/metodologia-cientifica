---
title: "An?lise explorat?ria de dados"
author:
  - "Gabriel Cintra"
  - "Francisco Edeverton"
  - "Maria Clara Dantas"
  - "Rafael Guerra"
  - "Raimundo Heitor"
date: "5 de julho de 2018"
output: html_document
---

```{r setup, include=FALSE, results='hide', fig.keep='all'}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggplot2)
theme_set(theme_bw())
```

Neste markdown iremos realisar uma pequena analise explorat?ria sobre as avalia??es realizadas por pessoas sobre as institui??es ANAC e INSS. Aabaixo est?o as bibliotecas necess?rias e os dados a serem carregados.

```{r}
#library(tidyverse)
#library(ggplot2)
```

```{r}
avaliacoes <- read_csv("data/3-avaliacao-humana/avaliacoes-20180610.csv")
reclamacoes <-  read_csv("data/1-reclamacoes-selecionadas/reclamacoes-avaliadas.csv")
```

## 1. Realizando tratamento nos dados
### 1.1. Inserindo colunas comprimento da reclamacao e do titulo
```{r}
reclamacoes <- reclamacoes %>% mutate(reclamacao.length = str_length(reclamacao),
                                      titulo.length = str_length(titulo))
```

### 1.1. Insere coluna com nÃºmero de letras em capslock
```{r}
reclamacoes$numero.de.capslock <- str_count(reclamacoes$reclamacao, "\\b[A-Z]{2,}\\b")
```

## H? alguma rela??o entre o n?vel de instatisfa??o geral das reclama??es e o n?mero de palavras em caixa alta presentes nelas?
```{r}
ggplot(reclamacoes, aes(x=mediana, y=numero.de.capslock)) + geom_point() + labs(x="Grau de insatisfação geral", y="Quantidade de palavras em caixa alta")
```

Com este plot, percebemos h? pouca rela??o entre as duas vari?veis. A reclama??o com maior n?mero de palavras em caixa alta, tem o menor n?vel de instatisfa??o geral baixa, enquanto que h? reclama??es com poucas ou nenhuma palavra em caixa alta que possuem o maior n?vel de insatisfa??o geral. Isso se confirma dado o baixo coeficiente de correla??o entre as duas variaveis:

```{r}
cor(reclamacoes$mediana, reclamacoes$numero.de.capslock)
```


## Das avalia??es realzadas, quantas foram feitas para cada n?vel de insatisfa??o?

```{r}
ggplot(avaliacoes, aes(x = `Grau de insatisfação`)) + geom_bar(width = 0.5) + labs(title = "Avaliações por grau de insatisfação", x="Grau de insatisfação", y="Quantidade de avaliações")
```

## Dos dois Ã³rgÃ£os apresentados, como estÃ£o distribuidas as avaliaÃ§Ãµes com grau maximo de insatisfaÃ§Ã£o?

A partir daqui, iremos alterar um pouco a frame de avaliaÃ§Ãµes para facilitar a anÃ¡lise
```{r}
avaliacoes <- avaliacoes %>% select(id = `ID da reclamação`, 
         insatisfacao = `Grau de insatisfação`)
```

Agora, observe o plot abaixo
```{r}
avaliacoes %>% group_by(id)  %>% inner_join(reclamacoes, by = "id") %>% filter(insatisfacao >= 5) %>% ggplot(aes(x=orgao)) + geom_bar(width = 0.5) + labs(title = "Avaliações de nível máximo por órgão", x="Órgão", y="Quantidade de avaliações")
```

Podemos observar dados interessantes. Das avaliaÃ§Ãµes com grau 5, vemos que a maior delas pertence Ã  ANAC. TambÃ©m podemos ver que o INSS possui 24 reclamaÃ§Ãµes de grau 5, enquanto a ANAC possui 42.

```{r}
avaliacoes %>% group_by(id) %>% filter(insatisfacao >=  %>% inner_join(reclamacoes, by = "id") %>% ggplot(aes(fill = orgao, x = numero.de.capslock), na.rm = TRUE) + 
geom_histogram(binwidth = 0.5, na.rm = TRUE) + facet_grid(orgao ~ .) + labs(x="Quantidade de palavras em caixa alta", y="Quantidade de avaliações", title="Avaliações de nível máximo em caixa alta por órgão")
```

